<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>DHAKA CENTRAL UNIVERSITY</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      background-color: #f0f2f5;
    }

    .header {
      background-color: #0c3c6d;
      color: white;
      padding: 1rem;
      text-align: center;
      font-size: 1.2rem;
    }

    .container {
      display: flex;
    }

    .sidebar {
      width: 250px;
      background-color: #e9ecef;
      min-height: calc(100vh - 56px);
      display: flex;
      flex-direction: column;
    }

    .sidebar-header {
      text-align: center;
      padding: 1rem;
    }

    .buet-logo {
      width: 100px;
      height: auto;
    }

    .menu {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .menu-item {
      display: block;
      padding: 1rem;
      color: #333;
      text-decoration: none;
      border-left: 5px solid transparent;
    }

    .menu-item:hover, .menu-item.active {
      background-color: #dcdcdc;
      border-left-color: #007bff;
    }

    .icon {
      margin-right: 10px;
    }

    .sidebar-footer {
      margin-top: auto;
      text-align: center;
      padding: 1rem;
      font-size: 0.9rem;
    }

    .sidebar-footer a {
        color: #007bff;
        text-decoration: none;
    }

    .main {
      flex-grow: 1;
      padding: 2rem;
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }

    .search-card {
      background-color: white;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 2rem;
      width: 100%;
      max-width: 400px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .card-title {
        text-align: center;
        margin-top: 0;
        margin-bottom: 0.5rem;
        font-size: 1.5rem;
    }

    .muted {
        text-align: center;
        color: #6c757d;
        margin-top: 0;
        margin-bottom: 1.5rem;
    }

    .form-field {
      margin-bottom: 1rem;
    }

    .form-field label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: bold;
    }

    .form-field input {
      width: 100%;
      padding: 0.5rem;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }

    .form-actions {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-top: 1.5rem;
    }
    
    .btn {
        padding: 0.6rem 1.2rem;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 1rem;
        text-align: center;
    }
    
    .btn-primary {
        background-color: #007bff;
        color: white;
    }
    
    .btn-ghost {
        background-color: white;
        color: #333;
        border: 1px solid #ccc;
    }

    .hidden {
      display: none;
    }

    .data-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 1rem;
    }

    .data-table td {
      padding: 0.5rem;
      border: 1px solid #ddd;
    }

  </style>
</head>
<body>

  <header class="header">
    Proposed Dhaka Central University (Implementation In Progress) Admission Management System
  </header>

  <div class="container">
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <img src="https://dcuadmission.org/images/cse-buet.png" alt="BUET Logo" class="buet-logo" />
        <p><b>CSE, BUET</b></p>
      </div>

      <nav class="menu">
        <a href="#" class="menu-item">
          <span class="icon">ðŸ“‘</span>
          <span class="text">Notice</span>
        </a>

        <a href="#/search" class="menu-item active" id="menu-search">
          <span class="icon">ðŸ”Ž</span>
          <span class="text">Search Student</span>
        </a>
      </nav>

      <div class="sidebar-footer">
        <p> &copy; 2025 - 26 <span class="bold"><a href="https://cse.buet.ac.bd/"> CSE, BUET</a></span></p>
      </div>
    </aside>

    <main class="main" id="main">
      <div class="search-card">
        <section id="search-view" class="card">
          <h3 class="card-title">Find Student</h3>
          <p class="muted">Enter your Roll No. and Serial No. to view the result</p>
          
          <form id="search-form" class="form-grid" onsubmit="return false;">
            <div class="form-field">
              <label for="roll">Roll No.</label>
              <input id="roll" type="text" inputmode="numeric" placeholder="Enter Your Roll" required/>
            </div>
  
            <div class="form-field">
              <label for="serial">Serial No.</label>
              <input id="serial" type="text" inputmode="numeric" placeholder="Enter Your Serial" required />
            </div>
  
            <div class="form-actions">
              <button type="button" class="btn btn-primary" id="getAdmitBtn">View Result</button>
              <button type="reset" class="btn btn-ghost" id="resetBtn">Reset</button>
            </div>
  
            <p id="search-error" class="error-text hidden">Please enter Correct Roll and Serial.</p>
          </form>
        </section>

        <section id="admit-view" class="hidden">
            <h3>Admission Test Result</h3>
            <div id="Personal-Information-Table-Container" class="data-table-container">
              <table id="Personal-Information-Table" class="data-table">
                <tbody></tbody>
              </table>
            </div>
          
          <div class="result-wrapper" id="result-box">
            <div id="Result-Table-Container" class="result-table-container">
              <h3>Subject Wise Score</h3>
              <table id="Result-Table" class="data-table">
                <thead>
                  <tr>
                    <td><b>Subject Name</b></td>
                    <td><b>Attempted</b></td>
                    <td><b>Correct</b></td>
                    <td><b>Wrong</b></td>
                    <td><b>Score</b></td>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
          <div class="form-actions">
            <button type="button" class="btn btn-primary" id="backToSearchBtn">Back to Search</button>
          </div>
        </section>
      </div>
    </main>
  </div>

  <script>
    const byId = (id) => document.getElementById(id);
    
    async function findStudent(body) {
      try {
        const response = await fetch("https://dcuadmission.org/backend/getResult", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ roll: body.roll, serial: body.serial })
        });
        if (!response.ok) {
            console.error("Server responded with status: " + response.status);
            return null;
        }
        return await response.json();
      } catch (err) {
        console.error("Fetch error:", err);
        return null;
      }
    }
    
    function processSubjectName(subject){
      const tokens = subject.split('_');
      const capTokens = tokens.map(token => token.charAt(0).toUpperCase() + token.slice(1));
      return capTokens.join(" ");
    }

    function renderAdmit(studentData) {
      const personalTableBody = byId("Personal-Information-Table").querySelector("tbody");
      const resultTableBody = byId("Result-Table").querySelector("tbody");
      personalTableBody.innerHTML = "";
      resultTableBody.innerHTML = "";
    
      const { base_result, subject_result } = studentData;
      const showAll = base_result.status === 'Passed' || base_result.status === 'Failed';

      const personalInfo = {
        "Name": base_result.name,
        "Status": base_result.status,
        "Roll No.": base_result.roll,
        "Test Score": showAll ? base_result.test_score : '-',
        "Serial No.": base_result.serial,
        "SSC Score": showAll ? base_result.ssc_score : '-',
        "HSC Roll": base_result.hscroll,
        "HSC Score": showAll ? base_result.hsc_score : '-',
        "HSC Year": base_result.hscyear,
        "Penalty": showAll ? base_result.penalty : '-',
        "HSC Board": base_result.hscboard,
        "Merit Score": showAll ? base_result.merit_score : '-',
        "Unit": base_result.unit,
        "Merit Position": showAll ? (base_result.merit_position ?? 'N/A') : '-',
      };

      const personalEntries = Object.entries(personalInfo);

      for (let i = 0; i < personalEntries.length; i += 2) {
        const row = document.createElement("tr");
        const [key1, value1] = personalEntries[i];
        let cell1 = `<td><b>${key1}</b></td><td>${value1}</td>`;
        
        let cell2 = `<td></td><td></td>`;
        if (personalEntries[i + 1]) {
          const [key2, value2] = personalEntries[i + 1];
          cell2 = `<td><b>${key2}</b></td><td>${value2}</td>`;
        }
        row.innerHTML = cell1 + cell2;
        personalTableBody.appendChild(row);
      }

      if(showAll && subject_result){
        byId('result-box').classList.remove('hidden');
        subject_result.forEach(result => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${processSubjectName(result.subject_name)}</td>
            <td>${result.attempted}</td>
            <td>${result.correct}</td>
            <td>${result.wrong}</td>
            <td>${result.score}</td>
          `;
          resultTableBody.appendChild(row);
        });
      } else {
        byId('result-box').classList.add('hidden');
      }
    }
    
    byId('getAdmitBtn').addEventListener('click', async () => {
      const roll = byId('roll').value.trim();
      const serial = byId('serial').value.trim();
      const errorText = byId('search-error');

      if (!roll || !serial) {
        errorText.textContent = 'Please enter Roll & Serial.';
        errorText.classList.remove('hidden');
        return;
      }
      
      errorText.classList.add('hidden');
      const data = await findStudent({ roll, serial });

      if (data && data.base_result) {
        renderAdmit(data);
        byId('search-view').classList.add('hidden');
        byId('admit-view').classList.remove('hidden');
      } else {
        errorText.textContent = 'No student found for the entered Roll and Serial.';
        errorText.classList.remove('hidden');
      }
    });

    byId('resetBtn').addEventListener('click', () => {
      byId('search-error').classList.add('hidden');
      byId('roll').value = '';
      byId('serial').value = '';
    });
    
    byId('backToSearchBtn').addEventListener('click', () => {
        byId('admit-view').classList.add('hidden');
        byId('search-view').classList.remove('hidden');
        byId('roll').value = '';
        byId('serial').value = '';
    });

  </script>
</body>
</html>